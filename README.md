# Где Перепечко
«Где Перепечко» воссоздаёт игру из одноимённой группы в VK. На серии картинок необходимо как можно скорее найти курсанта из сериала «Кадетство» Николая Перепечко.

## Работа над приложением
Для работы над своей версией игры вам понадобится новый проект Firebase.

1. Откройте терминал в папке, куда хотите скачать проект, и выполните в нём команду
   ```
   git clone https://github.com/hdito/gdeperepechko.git
   ```
   После чего перейдите в папку с проектом.
   ```
   cd gdeperepechko
   ```
2. Создайте в корне проекта файл `.env.development` для конфигурации проекта Firebase.
3. Создайте новый проект в [Firebase Console](https://console.firebase.google.com) и зарегистрируйте к нему веб-приложение. Вам выдадут данные для конфигурации. Перепешите их в созданный файл `.env.development`, заменяя формат ключей с camelCase на CONSTANT_CASE и добавляя к ним префикс `VITE`. В результате строка `apiKey: "ABC123abc"` из консоли Firebase должна выглядеть, как `VITE_API_KEY=ABC123abc`.
4. Подключите в Firebase Console аутентификацию при помощи Google, а также Cloud Storage и Firestore Database для хранения данных.
5. Установите необходимые зависимости предпочтительным пакетным менеджером. Для этого выполните в терминале одну из приведённых команд.
   
   Для установки через npm:
   ```
   npm install
   ```
   Yarn:
   ```
   yarn
   ```
   pnpm:
   ```
   pnpm install
   ```
6. После успешной установки вы сможете запустить локальный сервер для разработки приложения.
   
   npm:
   ```
   npm run dev
   ```
   Yarn:
   ```
   yarn run dev
   ```
   pnpm:
   ```
   pnpm run dev
   ```
   Vite подгрузит данные из файла `.env.development` для инициализации приложения и запустит сервер.
7. Для добавления новых карточек с Перепечко у вас должно быть две версии изображения: одна не больше 300 пикселей в ширину для миниатюры в главном меню, а другая — полная версия изображения для игры. Обе картинки должны иметь одинаковое название. Загрузите миниатюру в папку cards на Cloud Storage, а полное изображение – в папку images. Также необходимо создать колекцию документов в Firestore, которая называется cards, и добавить туда документ, описывающий карточку. Документ должен иметь id по названию картинки и содержать поля `id` и `coords`. `id` повторяет id документа, а `coords` представляет собой объект с полями `x1`, `x2`, `y1`, `y2`, описывающие левую, правую, нижнюю и верхнюю границы области, которая будет распознана как найденный Перепечко. Координаты с `x` рассчитаны как отношение границы к ширине изображения, а с `y` – к высоте. Таким образом, документ должен выглядеть следующим образом:
   ```javascript
   id: "1234567890";
   coords: {
      x1: 0.415;
      x2: 0.44;
      y1: 0.55;
      y2: 0.705;
   }
   ```
8. Для настройки прав доступа к Cloud Storage и Firestore Database вы можете либо вручную скопировать содержимое файлов `firestore.rules` и `storage.rules` во вкладку rules у соответствующих сервисов во вкладке проекта в Firebase Console, либо настроить [Firebase CLI](https://firebase.google.com/docs/cli), чтобы сделать это при помощи команд в терминале. Если вы предпочтёте второй вариант, то при инициализации инструментов в вашей рабочей директории подключите Cloud Storage с Firestore Database и используйте для них имеющиеся файлы `firestore.rules` и `storage.rules`.

## Сборка приложения
Рекомендуется использовать разные проекты Firebase для разработки и продакшена. В таком случае можно убрать `localhost` из списка разрешённых доменов для запросов у публичного проекта и оставить доступ к нему только девелоперскому приложению. С грамотно написанными правилами безопасности злоумышленник мало что сможет сделать c пользовательской информацией, но как разработчик вы, скорей всего, не хотите случайно исказить публичную базу данных.

1. Если вы хотите не смешивать пользовательские данные с теми, что используете в разработке, заведите новый проект в Firebase Console, зарегистрируйте для него web-приложение и скопируйте выданные ключи в файл `.env.production`, созданный предварительно в корне проекта, в такой же записи, что и в файле `.env.development`. 

   Вы можете обновить правила безопасности публичного проекта либо вручную, как в пункте 8, либо при помощи Firebase CLI. В последнем случае также необходимо добавить публичный проект в вашу рабочую папку командой
   ```
   firebase use --add
   ```
   Теперь для переключения проекта Firebase, с которым вы работаете, можно использовать команду
   ```
   firebase use <alias>
   ```
   Где `<alias>` вы назначаете при выполнении предыдущей команды.

   Если вы предпочтёте использовать один проект и для разработки, и для публичного доступа переименуйте файл с переменными среды из `.env.development` в `.env`.

2. Выполните команду сборки в терминале при помощи своего пакетного менеджера.
   
   npm:
   ```
   npm run build
   ```
   Yarn:
   ```
   yarn run build
   ```
   pnpm:
   ```
   pnpm run build
   ```
3. По умолчанию Linaria не добавляет файл `styles.css` в `index.html`, поэтому допишите в собранном приложении в папке `docs/` файлу `index.html` в тег `head` строчку `<link rel="stylesheet" href="./styles.css"/>`.

## Контакты
Если у вас возникла проблема или вы хотите задать вопрос, напишите мне на почту hditow@gmail.com